<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      handlers/customers.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-dark.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="342522" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="module-CustomersHandler.html">CustomersHandler</a></li><li class="accordion-list" id=""><a href="module-CustomersRouetes.html">CustomersRouetes</a></li><li class="accordion-list" id=""><a href="module-DiscountsHandler.html">DiscountsHandler</a></li><li class="accordion-list" id=""><a href="module-DiscountsRoutes.html">DiscountsRoutes</a></li><li class="accordion-list" id=""><a href="module-EnvoicesHandler.html">EnvoicesHandler</a></li><li class="accordion-list" id=""><a href="module-InvoicesRoutes.html">InvoicesRoutes</a></li></ul> </div></div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        handlers/customers.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//@ts-check
/**@Module CustomersHandler */

import {Op} from 'sequelize'
import modelCustomers from '../database/models/customers'
import {validateDiscounts} from './discounts'

/**
 * Devuelve una lista con todos los clientes.
 * @param {Object} req objeto de solicitud http 
 * @param {Object} res objeto de respuesta http
 */
export const getAllCustomers = async (req,res)=>{
    /** Extrae todos los clientes de la base de datos */
    const data = await modelCustomers.findAll() 
    /** Devuelve una lista en formato Json con todos los clientes*/
    res.status(200).json([...data])
}

/**
 * Crea un nuevo cliente en la base de datos
 * @param {Object} req Objeto con la solicitud http
 * @param {Object} res Objeto con la respuesta http
 */
export const createCustomer = async (req,res)=>{
    /** Extrae los datos de name y discounts del cuerpo de la solicitud 
     * y las guarda en sus respectivas constantes por medio de desestructuración de objeto
    */
    const {name, discounts} = req.body

    /**si alguno de los datos necesarios no existe envía un error 400
     * y frena la ejecución de la función
     */
    if(!name || !discounts){ 
         res.status(400).json({message:'Invalid Request'})
         return
    }

    /** Si existe uno o más descuentos en los datos inicia una validación */
    if(discounts.length > 0){
        /** Se valida que los descuentos pasados en la solicitud existan en la base de datos */
        const validate = await validateDiscounts(discounts)

        /** Si no existe alguno de los descuentos enviados envía un error 400 
         * y frena la ejecución de la función
        */
        if(!validate){
         res.status(400).json({message:'One or more invalid discount types'})
         return 
        }
    }
    
    try{

        /** Crea el nuevo usuario en la base de datos */
        const customer = await modelCustomers.create({
            name,
            discounts: discounts,
            createdAt: new Date(),
            updatedAt: new Date()
        })

        /** Devuelve status 200 con los datos del usuario creado y un mensaje de éxitos */
        res.status(200).json({
            message:'The customer was created!',
            data:customer
        })
        
    }catch(err){
        /** Si falla la creación del cliente devuelve un error 500 */
        res.status(500).json({message:'Internal Server Error'})
    }

}

/**
 * Extrae un usuario específico por su id
 * @param {Object} req Objeto con la solicitud http
 * @param {Object} res Objeto con la respuesta http
 */
export const getCustomerById = async (req,res)=>{

    /** Se guardan los datos del parámetro id en una constante */
    const {id} = req.params

    /** Si el valor del parámetro no es un número o no existe devuelve un error 400 
     * y frena la ejecución de la función
    */
    if(isNaN(Number(id))){
        res.status(400).send({message:'Invalid Format'})
        return
    }

    /** Se realiza una consulta a la base de datos donde el id del cliente sea igual al enviado */
    const customer = await modelCustomers.findOne({where:{id: Number(id) }})

    /** Si no encuentra al cliente devuelve un error 404
     * y frena la ejecución de la función
    */
    if(!customer){
        res.status(404).send({message:'Customer not Found'})
        return
    }

    /** Devuelve los datos del cliente con un status 200 */
    res.status(200).json(customer)
    
    
}

/**
 * Busca coincidencias de clientes por un nombre 
 * @param {Object} req Objeto con la solicitud http
 * @param {Object} res Objeto con la respuesta http
 */
export const getCustomerByName = async (req,res)=>{
    /** Extrae el valor de name en los parámetros y lo guarda en una constante*/
    const {name} = req.params

    /**si no hay un nombre devuelve error 400 y frena la ejecución */
    if(!name){
        res.status(400).send({message:'Invalid Request'})
        return
    }

    /** Realiza una búsqueda de coincidencia con name en la base de datos*/
    const customer = await modelCustomers.findAll({where:{name: {[Op.iLike]: `%${name}%`} }})

    /** Si no consigue ninguna coincidencia devuelve un error 404 */
    if(customer.length === 0){
        res.status(404).send({message:'Customer not Found'})
        return
    }

    /**Devuelve una lista con todas las coincidencias encontradas */
    res.status(200).json(customer)
}</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"CustomersHandler","link":"<a href=\"module-CustomersHandler.html\">CustomersHandler</a>"},{"title":"CustomersRouetes","link":"<a href=\"module-CustomersRouetes.html\">CustomersRouetes</a>"},{"title":"DiscountsHandler","link":"<a href=\"module-DiscountsHandler.html\">DiscountsHandler</a>"},{"title":"DiscountsRoutes","link":"<a href=\"module-DiscountsRoutes.html\">DiscountsRoutes</a>"},{"title":"EnvoicesHandler","link":"<a href=\"module-EnvoicesHandler.html\">EnvoicesHandler</a>"},{"title":"InvoicesRoutes","link":"<a href=\"module-InvoicesRoutes.html\">InvoicesRoutes</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    

    


  </body>

</html>
